version: 2

workflows:
  version: 2
  pipeline:
    jobs:
    - 0-unit-py36

jobs:
  0-unit-py36:
    docker: [{image: "circleci/python:3.6-stretch"}]
    environment:
      XDG_CACHE_HOME: /home/circleci/workspace/.cache/
    working_directory: /home/circleci/workspace
    steps:
    - checkout
    - restore_cache:
        key: v1-cornac-unit
    - run:
        name: Install requirements
        command: |
          sudo apt-get -qq update -y;
          sudo apt-get -qq install --no-install-recommends libev-dev;
          cd service/;
          poetry install;
    - save_cache:
        key: v1-cornac-unit-{{ epoch }}
        paths: ["~/workspace/.cache/"]
    - run:
        name: Python tests
        command: |
          cd service/;
          poetry run flake8 cornac/ tests/;
          poetry run pytest -x tests/unit/;
